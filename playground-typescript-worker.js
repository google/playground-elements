import A from"./internal/typescript.js";
/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const e=Symbol("Comlink.proxy"),t=Symbol("Comlink.endpoint"),n=Symbol("Comlink.releaseProxy"),i=Symbol("Comlink.finalizer"),o=Symbol("Comlink.thrown"),s=A=>"object"==typeof A&&null!==A||"function"==typeof A,r=new Map([["proxy",{canHandle:A=>s(A)&&A[e],serialize(A){const{port1:e,port2:t}=new MessageChannel;return Q(A,e),[t,[t]]},deserialize:A=>(A.start(),c(A,[],undefined))}],["throw",{canHandle:A=>s(A)&&o in A,serialize({value:A}){let e;return e=A instanceof Error?{isError:!0,value:{message:A.message,name:A.name,stack:A.stack}}:{isError:!1,value:A},[e,[]]},deserialize(A){if(A.isError)throw Object.assign(Error(A.value.message),A.value);throw A.value}}]]);function Q(A,t=globalThis,n=["*"]){t.addEventListener("message",(function s(r){if(!r||!r.data)return;if(!function(A,e){for(const t of A){if(e===t||"*"===t)return!0;if(t instanceof RegExp&&t.test(e))return!0}return!1}(n,r.origin))return void console.warn(`Invalid origin '${r.origin}' for comlink proxy`);const{id:g,type:C,path:B}=Object.assign({path:[]},r.data),E=(r.data.argumentList||[]).map(h);let c;try{const t=B.slice(0,-1).reduce(((A,e)=>A[e]),A),n=B.reduce(((A,e)=>A[e]),A);switch(C){case"GET":c=n;break;case"SET":t[B.slice(-1)[0]]=h(r.data.value),c=!0;break;case"APPLY":c=n.apply(t,E);break;case"CONSTRUCT":c=function(A){return Object.assign(A,{[e]:!0})}(new n(...E));break;case"ENDPOINT":{const{port1:e,port2:t}=new MessageChannel;Q(A,t),c=function(A,e){return d.set(A,e),A}(e,[e])}break;case"RELEASE":c=void 0;break;default:return}}catch(A){c={value:A,[o]:0}}Promise.resolve(c).catch((A=>({value:A,[o]:0}))).then((e=>{const[n,o]=p(e);t.postMessage(Object.assign(Object.assign({},n),{id:g}),o),"RELEASE"===C&&(t.removeEventListener("message",s),a(t),i in A&&"function"==typeof A[i]&&A[i]())})).catch((A=>{const[e,n]=p({value:new TypeError("Unserializable return value"),[o]:0});t.postMessage(Object.assign(Object.assign({},e),{id:g}),n)}))})),t.start&&t.start()}function a(A){(function(A){return"MessagePort"===A.constructor.name})(A)&&A.close()}function g(A){if(A)throw Error("Proxy has been released and is not useable")}function C(A){return f(A,{type:"RELEASE"}).then((()=>{a(A)}))}const B=new WeakMap,E="FinalizationRegistry"in globalThis&&new FinalizationRegistry((A=>{const e=(B.get(A)||0)-1;B.set(A,e),0===e&&C(A)}));function c(A,e=[],i=function(){}){let o=!1;const s=new Proxy(i,{get(t,i){if(g(o),i===n)return()=>{!function(A){E&&E.unregister(A)}(s),C(A),o=!0};if("then"===i){if(0===e.length)return{then:()=>s};const t=f(A,{type:"GET",path:e.map((A=>A.toString()))}).then(h);return t.then.bind(t)}return c(A,[...e,i])},set(t,n,i){g(o);const[s,r]=p(i);return f(A,{type:"SET",path:[...e,n].map((A=>A.toString())),value:s},r).then(h)},apply(n,i,s){g(o);const r=e[e.length-1];if(r===t)return f(A,{type:"ENDPOINT"}).then(h);if("bind"===r)return c(A,e.slice(0,-1));const[Q,a]=l(s);return f(A,{type:"APPLY",path:e.map((A=>A.toString())),argumentList:Q},a).then(h)},construct(t,n){g(o);const[i,s]=l(n);return f(A,{type:"CONSTRUCT",path:e.map((A=>A.toString())),argumentList:i},s).then(h)}});return function(A,e){const t=(B.get(e)||0)+1;B.set(e,t),E&&E.register(A,e,A)}(s,A),s}function l(A){const e=A.map(p);return[e.map((A=>A[0])),(t=e.map((A=>A[1])),Array.prototype.concat.apply([],t))];var t}const d=new WeakMap;function p(A){for(const[e,t]of r)if(t.canHandle(A)){const[n,i]=t.serialize(A);return[{type:"HANDLER",name:e,value:n},i]}return[{type:"RAW",value:A},d.get(A)||[]]}function h(A){switch(A.type){case"HANDLER":return r.get(A.name).deserialize(A.value);case"RAW":return A.value}}function f(A,e,t){return new Promise((n=>{const i=[,,,,].fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-");A.addEventListener("message",(function e(t){t.data&&t.data.id&&t.data.id===i&&(A.removeEventListener("message",e),n(t.data))})),A.start&&A.start(),A.postMessage(Object.assign({id:i},e),t)}))}const u=1===new Uint8Array(new Uint16Array([1]).buffer)[0];function I(A,e="@"){if(!v)return m.then((()=>I(A)));const t=A.length+1,n=(v.__heap_base.value||v.__heap_base)+4*t-v.memory.buffer.byteLength;n>0&&v.memory.grow(Math.ceil(n/65536));const i=v.sa(t-1);if((u?w:k)(A,new Uint16Array(v.memory.buffer,i,t)),!v.parse())throw Object.assign(Error(`Parse error ${e}:${A.slice(0,v.e()).split("\n").length}:${v.e()-A.lastIndexOf("\n",v.e()-1)}`),{idx:v.e()});const o=[],s=[];for(;v.ri();){const e=v.is(),t=v.ie(),n=v.ai(),i=v.id(),s=v.ss(),Q=v.se();let a;v.ip()&&(a=r(A.slice(-1===i?e-1:e,-1===i?t+1:t))),o.push({n:a,s:e,e:t,ss:s,se:Q,d:i,a:n})}for(;v.re();){const e=v.es(),t=v.ee(),n=v.els(),i=v.ele(),o=A.slice(e,t),Q=o[0],a=n<0?void 0:A.slice(n,i),g=a?a[0]:"";s.push({s:e,e:t,ls:n,le:i,n:'"'===Q||"'"===Q?r(o):o,ln:'"'===g||"'"===g?r(a):a})}function r(A){try{return(0,eval)(A)}catch(A){}}return[o,s,!!v.f(),!!v.ms()]}function k(A,e){const t=A.length;let n=0;for(;n<t;){const t=A.charCodeAt(n);e[n++]=(255&t)<<8|t>>>8}}function w(A,e){const t=A.length;let n=0;for(;n<t;)e[n]=A.charCodeAt(n++)}let v;const m=WebAssembly.compile((K="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","undefined"!=typeof Buffer?Buffer.from(K,"base64"):Uint8Array.from(atob(K),(A=>A.charCodeAt(0))))).then(WebAssembly.instantiate).then((({exports:A})=>{v=A}));var K;
/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */class D{constructor(){this._buffer=[],this._numSources=0,this._done=!1}async*[Symbol.asyncIterator](){for(;this._numSources>0;){for(;this._buffer.length>0;){const{value:A,emitted:e}=this._buffer.shift();yield A,e()}await new Promise((A=>this._notify=A)),this._notify=void 0}this._done=!0}add(A){if(this._done)throw Error("Merged iterator is exhausted. Cannot add new source iterators.");this._numSources++,(async()=>{var e;for await(const e of A)await new Promise((A=>{var t;this._buffer.push({value:e,emitted:A}),null===(t=this._notify)||void 0===t||t.call(this)}));this._numSources--,null===(e=this._notify)||void 0===e||e.call(this)})()}}const y=(A,e)=>new URL(e,new URL(A,"ws://_")).pathname,N=A=>{try{return new URL(A).href,"url"}catch{}return null!==A.match(/^(\.){0,2}\//)?"relative":"bare"},J=A=>{const e=A.match(/^((?:@[^/@]+\/)?[^/@]+)(?:@([^/]+))?\/?(.*)$/);if(null===e)return;const[,t,n,i]=e;return{pkg:t,version:null!=n?n:"",path:i}},L=A=>{const e=A.lastIndexOf("/"),t=A.lastIndexOf(".");return-1===t||t<e?"":A.slice(t+1)},F=(A,e)=>{const t=L(A);return""===t?A+"."+e:A.slice(0,-t.length)+e},S=(A,e)=>{let t=0,n=0;for(let i=0;i<e&&i<A.length;i++)"\n"===A[i]?(t++,n=0):n++;return{line:t,character:n}},R=A=>null!==A.match(/^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$/),U=({pkg:A,version:e})=>`${A}@${e||"latest"}`,_=({pkg:A,version:e,path:t})=>q(`${U({pkg:A,version:e})}/${M(t)}`),M=A=>A.startsWith("/")?A.slice(1):A,q=A=>A.endsWith("/")?A.slice(0,-1):A
/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */;class Y{constructor(){this.settled=!1,this.promise=new Promise(((A,e)=>{this._resolve=A,this._reject=e}))}resolve(A){this.settled=!0,this._resolve(A)}reject(A){this.settled=!0,this._reject(A)}}
/**
 * @license
 * Copyright 2016 Node.js contributors. All rights reserved.
 * SPDX-License-Identifier: MIT
 */function G(A){if("string"==typeof A&&(A=new URL(A)),"file:"!==A.protocol)throw Error("The URL must be of scheme file");return A.pathname}
/**
 * @license
 * Copyright 2017 Node.js contributors. All rights reserved.
 * SPDX-License-Identifier: MIT
 */class b extends Error{constructor(A,e,t){super(`Invalid module "${A}" ${e}${t?" imported from "+t:""}`)}}class x extends Error{constructor(A,e,t){super(`Invalid package config ${A}${e?" while importing "+e:""}${t?". "+t:""}`)}}class j extends Error{constructor(A,e,t,n=!1,i){const o="string"==typeof t&&!n&&t.length&&!t.startsWith("./");let s;s="."===e?`Invalid "exports" main target ${JSON.stringify(t)} defined in the package config ${G(A)}package.json${i?" imported from "+i:""}${o?'; targets must start with "./"':""}`:`Invalid "${n?"imports":"exports"}" target ${JSON.stringify(t)} defined for '${e}' in the package config ${G(A)}package.json${i?" imported from "+i:""}${o?'; targets must start with "./"':""}`,super(s)}}class P extends Error{constructor(A,e,t){super("."===e?`No "exports" main defined in ${A}package.json${t?" imported from "+t:""}`:`Package subpath '${e}' is not defined by "exports" in ${A}package.json${t?" imported from "+t:""}`)}}
/**
 * @license
 * Copyright 2020 Node.js contributors. All rights reserved.
 * SPDX-License-Identifier: MIT
 */function H(A,e,t){return new P(G(new URL(".",e)),A,t)}function $(A,e,t,n,i){return e="object"==typeof e&&null!==e?JSON.stringify(e,null,""):""+e,new j(t,A,e,n,i)}const O=/(^|\\|\/)(\.\.?|node_modules)(\\|\/|$)/,T=/\*/g;function X(A){const e=+A;return""+e===A&&e>=0&&e<4294967295}function W(A,e,t,n,i,o,s,r){if("string"==typeof e)return function(A,e,t,n,i,o,s,r){if(""!==e&&!o&&"/"!==A[A.length-1])throw $(t,A,n,s,i);if(!A.startsWith("./"))throw $(t,A,n,s,i);if(O.test(A.slice(2)))throw $(t,A,n,s,i);const Q=new URL(A,n),a=Q.pathname,g=new URL(".",n).pathname;if(!a.startsWith(g))throw $(t,A,n,s,i);if(""===e)return Q;if(O.test(e))throw function(A,e,t,n){const i=`request is not a valid subpath for the "${t?"imports":"exports"}" resolution of ${G(e)}`;return new b(A,i,n)}(t+e,n,s,i);return o?new URL(Q.href.replace(T,e)):new URL(e,Q)}(e,t,n,A,i,o,s);if(Array.isArray(e)){if(0===e.length)return null;let Q;for(let a=0;a<e.length;a++){const g=e[a];let C;try{C=W(A,g,t,n,i,o,s,r)}catch(A){if(Q=A,A instanceof j)continue;throw A}if(void 0!==C){if(null!==C)return C;Q=null}}if(null==Q)return Q;throw Q}if("object"!=typeof e||null===e){if(null===e)return null;throw $(n,e,A,s,i)}{const Q=Object.getOwnPropertyNames(e);for(let e=0;e<Q.length;e++)if(X(Q[e]))throw new x(G(A),i,'"exports" cannot contain numeric property keys.');for(let a=0;a<Q.length;a++){const g=Q[a];if("default"===g||r.has(g)){const Q=W(A,e[g],t,n,i,o,s,r);if(void 0===Q)continue;return Q}}}}function Z(A,e){const t=A.indexOf("*"),n=e.indexOf("*"),i=-1===t?A.length:t+1,o=-1===n?e.length:n+1;return i>o?-1:o>i||-1===t?1:-1===n||A.length>e.length?-1:e.length>A.length?1:0}
/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */class V{constructor({conditions:A}){this._conditions=new Set(A)}resolve(A,e,t){const n=z(A.path);if(void 0===e.exports)return"."===n?void 0!==e.module?AA(e.module):void 0!==e.main?AA(e.main):"index.js":A.path;const i=`/node_modules/${A.pkg}@${A.version}/`,o=function(A,e,t,n,i){let o=t.exports;if(function(A,e,t){if("string"==typeof A||Array.isArray(A))return!0;if("object"!=typeof A||null===A)return!1;const n=Object.getOwnPropertyNames(A);let i=!1,o=0;for(let A=0;A<n.length;A++){const s=n[A],r=""===s||"."!==s[0];if(0==o++)i=r;else if(i!==r)throw new x(G(e),t,"\"exports\" cannot contain some keys starting with '.' and some not. The exports object must either be an object of package subpath keys or an object of main entry condition name keys only.")}return i}(o,A,n)&&(o={".":o}),Object.prototype.hasOwnProperty.call(o,e)&&!e.includes("*")&&!e.endsWith("/")){const t=W(A,o[e],"",e,n,!1,!1,i);if(null==t)throw H(e,A,n);return t}let s,r="";for(const A of Object.keys(o)){const t=A.indexOf("*");if(-1!==t&&e.startsWith(A.slice(0,t))){const n=A.slice(t+1);e.length>=A.length&&e.endsWith(n)&&1===Z(r,A)&&A.lastIndexOf("*")===t&&(r=A,s=e.slice(t,e.length-n.length))}else A.endsWith("/")&&e.startsWith(A)&&1===Z(r,A)&&(r=A,s=e.slice(A.length))}if(r){const t=o[r],Q=r.includes("*"),a=W(A,t,s,r,n,Q,!1,i);if(null==a)throw H(e,A,n);return Q||function(A,e,t,n){const i=G(e);console.warn(`Use of deprecated folder mapping "${A}" in the "exports" field module resolution of the package at ${i}${n?" imported from "+n:""}.\nUpdate this package.json to use a subpath pattern like "${A}*".`,"DeprecationWarning","DEP0148")}(r,A,0,n),a}throw H(e,A,n)}(new URL(i,"file://"),n,e,t,this._conditions);if(!o.pathname.startsWith(i))throw Error(`Unexpected error: ${o.pathname} expected to start with ${i}`);return o.pathname.slice(i.length)}}const z=A=>""===A?".":A.startsWith(".")||A.startsWith("/")?A:"./"+A,AA=A=>"."===A?"":A.startsWith("./")?A.slice(2):A;
/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
class eA{constructor(A,e){this._emittedExternalDependencies=new Set,this._nodeResolver=new V({conditions:["module","import","development","browser"]}),this._cdn=A,this._importMapResolver=e}async*process(A){const e=new D;e.add(this._handleProjectFiles(A,e)),yield*e}async*_handleProjectFiles(A,e){const t=new Y,n=()=>t.promise;for await(const i of A)if("file"===i.kind&&i.file.name.endsWith(".js"))e.add(this._handleModule(i,n,e));else if(yield i,"file"===i.kind&&"package.json"===i.file.name){let A;try{A=JSON.parse(i.file.content)}catch(A){yield nA(A,i.file)}void 0!==A&&t.resolve(A)}t.settled||t.resolve(void 0)}async*_handleModule(A,e,t){let n,i=A.file.content;await m;try{[n]=I(i)}catch(e){yield A;const t=tA(e,A.file.name);return void(void 0!==t&&(yield t))}const o=[];for(let i=n.length-1;i>=0;i--){const{n:s}=n[i];void 0!==s&&o.push({info:n[i],newSpecifierPromise:this._handleSpecifier(s,A.file.name,e,t)})}for(const{info:{s:e,e:t,n,d:s},newSpecifierPromise:r}of o){let o;try{o=await r}catch(o){yield{kind:"diagnostic",filename:A.file.name,diagnostic:{message:`Could not resolve module "${n}": ${o.message}`,range:{start:S(i,e),end:S(i,t)}}};continue}if(o===n)continue;const Q=-1!==s?`'${o}'`:o;i=i.substring(0,e)+Q+i.substring(t)}A.file.content=i,yield A}async _handleSpecifier(A,e,t,n){const i=this._importMapResolver.resolve(A);if(null!==i)return i;const o=N(A);if("url"===o)return A;if("bare"===o)return this._handleBareSpecifier(A,e,t,n);if(!e.startsWith("node_modules/"))return A;const s=y(e,A).slice(14);if(!L(A))return this._handleBareSpecifier(s,e,(async()=>{}),n);const r=J(s);if(void 0===r)throw Error(`Invalid specifier "${s}"`);return n.add(this._fetchExternalDependency(r,n)),A}async _handleBareSpecifier(A,e,t,n){var i,o,s;let r=J(A);if(void 0===r)throw Error(`Invalid specifier "${A}"`);r.version||(r.version=null!==(s=null===(o=null===(i=await t())||void 0===i?void 0:i.dependencies)||void 0===o?void 0:o[r.pkg])&&void 0!==s?s:"latest"),r.version=await this._cdn.resolveVersion(r);const Q=await this._cdn.fetchPackageJson(r);return r.path=this._nodeResolver.resolve(r,Q,e),L(r.path)||(r=await this._cdn.canonicalize(r)),n.add(this._fetchExternalDependency(r,n)),((A,e)=>{const t=A.split("/"),n=e.split("/");let i=0;for(;i<t.length&&i<n.length&&t[i]===n[i];)i++;const o=t.length-i-1;return(0===o?"./":Array(o+1).join("../"))+n.slice(i).join("/")})(e,`node_modules/${r.pkg}@${r.version}/${r.path}`)}async*_fetchExternalDependency(A,e){const t=`${A.pkg}@${A.version}/${A.path}`;if(this._emittedExternalDependencies.has(t))return;let n;this._emittedExternalDependencies.add(t);try{n=await this._cdn.fetch(A)}catch(A){return void console.error(`Error fetching ${t} from CDN: ${A.message}`)}let i=null;yield*this._handleModule({kind:"file",file:{name:"node_modules/"+t,content:n.content,contentType:n.contentType}},(async()=>{if(null===i)try{i=await this._cdn.fetchPackageJson(A)}catch{i=void 0}return i}),e)}}const tA=(A,e)=>{const t=A.message.match(/@:(\d+):(\d+)$/);if(null===t)return;const n=Number(t[1])-1,i=Number(t[2])-1;return{kind:"diagnostic",filename:e,diagnostic:{message:"es-module-lexer error: "+A.message,range:{start:{line:n,character:i},end:{line:n,character:i+1}}}}},nA=(A,e)=>{var t;const n=null!==(t=iA(A.message,e.content))&&void 0!==t?t:{line:0,character:0};return{kind:"diagnostic",filename:e.name,diagnostic:{message:"Invalid package.json: "+A,range:{start:n,end:S(e.content,e.content.length)}}}},iA=(A,e)=>{const t=A.match(/at position (\d+)/);if(null!==t)return S(e,Number(t[1]));const n=A.match(/at line (\d+) column (\d+)/);return null!==n?{line:Number(n[1])-1,character:Number(n[2])-1}:void 0},oA={target:A.ScriptTarget.ES2021,module:A.ModuleKind.ESNext,experimentalDecorators:!0,skipDefaultLibCheck:!0,skipLibCheck:!0,allowJs:!0,moduleResolution:A.ModuleResolutionKind.NodeNext,jsx:A.JsxEmit.React,lib:["dom","esnext"]};class sA{constructor(){this.compilerOptions=oA,this.serviceHost=new rA(self.origin,oA),this.service=A.createLanguageService(this.serviceHost,A.createDocumentRegistry())}}class rA{constructor(A,e){this.files=new Map,this.packageRoot=A,this.compilerOptions=e}updateFileContentIfNeeded(A,e){const t=this.files.get(A);t&&t.content!==e?(t.content=e,t.version+=1):this.files.set(A,{content:e,version:0})}sync(A){A.forEach(((A,e)=>this.updateFileContentIfNeeded(e,A))),this._removeDeletedFiles(A)}_removeDeletedFiles(A){this.getScriptFileNames().forEach((e=>{e.includes("node_modules")||A.has(e)||this.files.delete(e)}))}getCompilationSettings(){return this.compilerOptions}getScriptFileNames(){return[...this.files.keys()]}getScriptVersion(A){var e,t;return null!==(t=null===(e=this.files.get(A))||void 0===e?void 0:e.version.toString())&&void 0!==t?t:"-1"}fileExists(A){return this.files.has(A)}readFile(A){var e;return null===(e=this.files.get(A))||void 0===e?void 0:e.content}getScriptSnapshot(e){if(this.fileExists(e))return A.ScriptSnapshot.fromString(this.readFile(e))}getCurrentDirectory(){return this.packageRoot}getDefaultLibFileName(){return"__lib.d.ts"}}
/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */class QA{constructor(A){this._fetchCache=new Map,this._versionCache=new Map,this._urlPrefix=A}async fetch(A){const{file:e}=await this._fetch(A);return e}async canonicalize(A){let e=R(A.version);if(!e){const t=U(A),n=this._versionCache.get(t);void 0!==n&&(A={...A,version:n},e=!0)}if(!e||""===L(A.path)){const{url:e}=await this._fetch(A);A=this._parseUnpkgUrl(e)}return A}async resolveVersion({pkg:A,version:e}){return(await this.canonicalize({pkg:A,version:e,path:"package.json"})).version}async fetchPackageJson({pkg:A,version:e}){const{url:t,file:{content:n}}=await this._fetch({pkg:A,version:e,path:"package.json"});try{return JSON.parse(n)}catch(A){throw Error(`Error parsing CDN package.json from ${t}: ${A}`)}}async _fetch(A){var e;let t=R(A.version);if(!t){const e=U(A),n=this._versionCache.get(e);void 0!==n&&(A={...A,version:n},t=!0)}const n=_(A),i=this._fetchCache.get(n);if(void 0!==i)return i.promise;const o=new Y;this._fetchCache.set(n,o);const s=this._urlPrefix+n,r=await fetch(s),Q=await r.text();if(200!==r.status){const A=Error(`CDN HTTP ${r.status} error (${s}): ${Q}`);return o.reject(A),o.promise}if(!t){const e=this._parseUnpkgUrl(r.url);this._versionCache.set(U(A),e.version),this._fetchCache.set(_(e),o)}const a={url:r.url,file:{content:Q,contentType:null!==(e=r.headers.get("content-type"))&&void 0!==e?e:"text/plain"}};return o.resolve(a),o.promise}_parseUnpkgUrl(A){if(A.startsWith(this._urlPrefix)){const e=J(A.slice(this._urlPrefix.length));if(void 0!==e)return e}throw Error("Unexpected CDN URL format: "+A)}}
/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */class aA{constructor(A){this.importMap=A}resolve(A){var e;for(const[t,n]of Object.entries(null!==(e=this.importMap.imports)&&void 0!==e?e:{})){if(t===A)return n;if(t.endsWith("/")&&A.startsWith(t)){if(!n.endsWith("/"))return console.warn(`Could not resolve module specifier "${A}" using import map key "${t}" because address "${n}" must end in a forward-slash.`),null;const e=A.substring(t.length);let i;try{i=new URL(e,n)}catch{return console.warn(`Could not resolve module specifier "${A}" using import map key "${t}" because "${e}" could not be parsed relative to "${n}".`),null}const o=i.href;return o.startsWith(n)?o:(console.warn(`Could not resolve module specifier "${A}" using import map key "${t}" because "${e}" backtracked above "${n}".`),null)}}return null}}
/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */let gA,CA="";function BA(A){const e=JSON.stringify(A);return gA&&CA===e||(CA=e,gA=new EA(A)),gA}class EA{constructor(A){var e;this.importMapResolver=new aA(A.importMap),this.cdn=new QA(null!==(e=A.cdnBaseUrl)&&void 0!==e?e:"https://unpkg.com/"),this.languageServiceContext=new sA}}
/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */class cA{layout(A,e){var t,n;const i={},o=[{dependencies:A,nodeModules:i,parent:null}];for(;o.length>0;){const A=o.shift();for(const[i,s]of Object.entries(A.dependencies)){let r=A,Q=!1;for(;null!==r.parent;){const A=null===(t=r.parent.nodeModules[i])||void 0===t?void 0:t.version;if(void 0!==A){Q=A===s;break}r=r.parent}if(Q)continue;const a={};r.nodeModules[i]={version:s,nodeModules:a};const g=null===(n=e[i])||void 0===n?void 0:n[s];void 0!==g&&o.push({dependencies:g,nodeModules:a,parent:r})}}return i}}
/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const lA=Symbol();class dA{static async fetchTypes(A,e,t,n,i){const o=new dA(A,e,t);await Promise.allSettled([...n.map((A=>o._handleBareAndRelativeSpecifiers(A,lA))),...i.map((A=>o._addTypeScriptStandardLib(A))),o._fetchTypesPackages()]);const s=(new cA).layout(o._rootDependencies,o._dependencyGraph),r=new Map;return await o._materializeNodeModulesTree(s,r,""),{files:r,layout:s,dependencyGraph:{root:o._rootDependencies,deps:o._dependencyGraph}}}constructor(A,e,t){this._rootDependencies={},this._dependencyGraph={},this._filesByPackageVersion=new Map,this._cdn=A,this._importMapResolver=e,this._rootPackageJson=t}async _fetchTypesPackages(){if(void 0===this._rootPackageJson||void 0===this._rootPackageJson.dependencies)return;const A=Object.keys(this._rootPackageJson.dependencies).filter((A=>A.startsWith("@types/")));0!==A.length&&await Promise.allSettled(A.map((A=>this._handleBareSpecifier(A,lA))))}async _addTypeScriptStandardLib(A){return this._handleBareSpecifier(`typescript/lib/lib.${A.toLowerCase()}.js`,lA)}async _handleBareAndRelativeSpecifiers(e,t){const n=A.preProcessFile(e,void 0,!0),i=[];for(const{fileName:A}of n.importedFiles){const e=N(A);"bare"===e?i.push(this._handleBareSpecifier(A,t)):"relative"===e&&t!==lA&&i.push(this._handleRelativeSpecifier(A,t))}for(const{fileName:A}of n.libReferenceDirectives)i.push(this._addTypeScriptStandardLib(A));await Promise.allSettled(i)}async _handleBareSpecifier(A,e){var t,n;let i=J(A);if(void 0===i)return;const o=null!==this._importMapResolver.resolve(A);if(o||(i.version=await this._getDependencyVersion(e,i.pkg)),i.path=await this._getDtsPath(i),o||(i=await this._cdn.canonicalize(i)),e!==lA&&i.pkg===e.pkg||this._addEdgeToDependencyGraph(e,i),void 0!==(null===(n=null===(t=this._filesByPackageVersion.get(i.pkg))||void 0===t?void 0:t.get(i.version))||void 0===n?void 0:n.get(i.path)))return;const s=await this._fetchAndAddToOutputFiles(i);void 0===s.error&&await this._handleBareAndRelativeSpecifiers(s.result,i)}async _handleRelativeSpecifier(A,e){var t,n;const i={pkg:e.pkg,version:e.version,path:M(y(e.path,A).slice(1))};if(i.path=F(i.path,"d.ts"),void 0!==(null===(n=null===(t=this._filesByPackageVersion.get(i.pkg))||void 0===t?void 0:t.get(i.version))||void 0===n?void 0:n.get(i.path)))return;const o=await this._fetchAndAddToOutputFiles(i);void 0===o.error&&await this._handleBareAndRelativeSpecifiers(o.result,i)}async _getDependencyVersion(A,e){var t,n;const i=A===lA?this._rootPackageJson:await this._fetchPackageJsonAndAddToOutputFiles(A);return null!==(n=null===(t=null==i?void 0:i.dependencies)||void 0===t?void 0:t[e])&&void 0!==n?n:"latest"}async _getDtsPath(A){var e,t,n;if(""!==A.path)return F(A.path,"d.ts");const i=await this._fetchPackageJsonAndAddToOutputFiles(A);return null!==(n=null!==(t=null!==(e=null==i?void 0:i.typings)&&void 0!==e?e:null==i?void 0:i.types)&&void 0!==t?t:void 0!==(null==i?void 0:i.main)?F(i.main,"d.ts"):void 0)&&void 0!==n?n:"index.d.ts"}async _fetchPackageJsonAndAddToOutputFiles(A){const e=await this._fetchAndAddToOutputFiles({...A,path:"package.json"});if(void 0!==e.error)throw Error(`Could not fetch package.json for ${A.pkg}@${A.version}: ${e.error}`);return JSON.parse(e.result)}async _fetchAndAddToOutputFiles(A){const e=this._importMapResolver.resolve(q(`${A.pkg}/${A.path}`));null===e&&(A=await this._cdn.canonicalize(A));let t=this._filesByPackageVersion.get(A.pkg);void 0===t&&(t=new Map,this._filesByPackageVersion.set(A.pkg,t));let n=t.get(A.version);void 0===n&&(n=new Map,t.set(A.version,n));let i=n.get(A.path);if(void 0!==i)return i;const o=new Y;let s;if(i=o.promise,n.set(A.path,i),null!==e){const A=await fetch(e);if(200!==A.status){const e={error:A.status};return o.resolve(e),e}s=await A.text()}else try{s=(await this._cdn.fetch(A)).content}catch{const A={error:404};return o.resolve(A),A}const r={result:s};return o.resolve(r),r}_addEdgeToDependencyGraph(A,e){if(A===lA)this._rootDependencies[e.pkg]=e.version;else{let t=this._dependencyGraph[A.pkg];void 0===t&&(t={},this._dependencyGraph[A.pkg]=t);let n=t[A.version];void 0===n&&(n={},t[A.version]=n),n[e.pkg]=e.version}}async _materializeNodeModulesTree(A,e,t){var n;for(const[i,o]of Object.entries(A)){const A=null===(n=this._filesByPackageVersion.get(i))||void 0===n?void 0:n.get(o.version);if(void 0!==A){for(const[n,o]of A){const A=await o;if(void 0===A.error){const o=`${t}${i}/${n}`;e.set(o,A.result)}}await this._materializeNodeModulesTree(o.nodeModules,e,`${t}${i}/node_modules/`)}}}}
/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function pA(e){var t;return{code:e.code,source:null!==(t=e.source)&&void 0!==t?t:"typescript",message:A.flattenDiagnosticMessageText(e.messageText,"\n"),severity:hA[e.category],range:{start:void 0!==e.file&&void 0!==e.start?e.file.getLineAndCharacterOfPosition(e.start):{character:0,line:0},end:void 0!==e.file&&void 0!==e.start&&void 0!==e.length?e.file.getLineAndCharacterOfPosition(e.start+e.length):{character:0,line:0}}}}const hA={[A.DiagnosticCategory.Error]:1,[A.DiagnosticCategory.Warning]:2,[A.DiagnosticCategory.Message]:3,[A.DiagnosticCategory.Suggestion]:4};
/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function fA(A){if(!A||0===A.length)return"";let e="";return A.forEach((A=>{e+=A.text})),e}function uA(A){var e;return null!==(e=null==A?void 0:A.map((A=>A.text)))&&void 0!==e?e:[]}
/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const IA={compileProject:async(A,e,t)=>{const n=BA(e),i=new eA(n.cdn,n.importMapResolver).process(async function*(A,e){const t=A.languageServiceContext.service,n=A.languageServiceContext.serviceHost;let i;const o=[];for await(const A of e)if("file"===A.kind&&(A.file.name.endsWith(".ts")||A.file.name.endsWith(".jsx")||A.file.name.endsWith(".tsx")))o.push(A.file);else if(yield A,"file"===A.kind&&"package.json"===A.file.name)try{i=JSON.parse(A.file.content)}catch(A){}if(0===o.length)return;const s=new Map,r=o.map((A=>({file:A,url:new URL(A.name,self.origin).href})));for(const{file:A,url:e}of r)s.set(e,A.content);const Q=void 0===i?{type:"module"}:"module"===i.type?i:{...i,type:"module"};s.set(new URL("package.json",self.origin).href,JSON.stringify(Q)),n.sync(s);const a=t.getProgram();if(void 0===a)throw Error("Unexpected error: program was undefined");for(const{file:A,url:e}of r){for(const n of t.getSyntacticDiagnostics(e))yield{kind:"diagnostic",filename:A.name,diagnostic:pA(n)};const n=a.getSourceFile(e);let i;a.emit(n,((A,e)=>{i={name:new URL(A).pathname.slice(1),content:e,contentType:"text/javascript"}})),void 0!==i&&(yield{kind:"file",file:i})}const g=await dA.fetchTypes(A.cdn,A.importMapResolver,i,r.map((A=>A.file.content)),A.languageServiceContext.compilerOptions.lib);for(const[A,e]of g.files){const t=new URL("node_modules/"+A,self.origin).href;n.updateFileContentIfNeeded(t,e)}for(const{file:A,url:e}of r)for(const n of t.getSemanticDiagnostics(e))yield{kind:"diagnostic",filename:A.name,diagnostic:pA(n)}}
/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */(n,A.map((A=>({kind:"file",file:A})))));for await(const A of i)t(A);t({kind:"done"})},getCompletions:async(A,e,t,n,i)=>{const o=BA(i),s=o.languageServiceContext.service,r=o.languageServiceContext.serviceHost,Q={};"."===t&&(Q.triggerCharacter=".");const a=new URL(A,self.origin).href;return r.updateFileContentIfNeeded(a,e),s.getCompletionsAtPosition(A,n,Q)},getCompletionItemDetails:async(A,e,t,n)=>{var i;const o=BA(t).languageServiceContext.service.getCompletionEntryDetails(A,e,n,void 0,void 0,void 0,void 0);return{text:fA(null==o?void 0:o.displayParts),tags:null!==(i=null==o?void 0:o.tags)&&void 0!==i?i:[],documentation:uA(null==o?void 0:o.documentation)}}};Q(IA);
